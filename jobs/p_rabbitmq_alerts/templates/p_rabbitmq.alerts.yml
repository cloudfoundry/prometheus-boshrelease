groups:
- name: p-rabbitmq
  rules:
  - alert: PRabbitMQServerDown
    expr: min(firehose_value_metric_p_rabbitmq_p_rabbitmq_rabbitmq_heartbeat) by(environment, bosh_deployment, bosh_job_name, bosh_job_ip) != 1
    for: <%= p('p_rabbitmq_alerts.server_down.evaluation_time') %>
    labels:
      service: p-rabbitmq
      severity: critical
    annotations:
      description: The RabbitMQ Server instance at `{{$labels.environment}}/{{$labels.bosh_deployment}}/{{$labels.bosh_job_name}}/{{$labels.bosh_job_ip}}` has been down for the last <%= p('p_rabbitmq_alerts.server_down.evaluation_time') %>
      summary: Rabbitmq for PCF Server instance `{{$labels.environment}}/{{$labels.bosh_deployment}}/{{$labels.bosh_job_name}}/{{$labels.bosh_job_ip}}` is down
  - alert: PRabbitMQHaProxyDown
    expr: min(firehose_value_metric_p_rabbitmq_p_rabbitmq_haproxy_heartbeat) by(environment, bosh_deployment, bosh_job_name, bosh_job_ip) != 1
    for: <%= p('p_rabbitmq_alerts.haproxy_down.evaluation_time') %>
    labels:
      service: p-rabbitmq
      severity: critical
    annotations:
      description: The RabbitMQ HaProxy instance at `{{$labels.environment}}/{{$labels.bosh_deployment}}/{{$labels.bosh_job_name}}/{{$labels.bosh_job_ip}}` has been down for the last <%= p('p_rabbitmq_alerts.haproxy_down.evaluation_time') %>
      summary: Rabbitmq for PCF HAProxy instance `{{$labels.environment}}/{{$labels.bosh_deployment}}/{{$labels.bosh_job_name}}/{{$labels.bosh_job_ip}}` is down
  - alert: PRabbitMQServiceBrokerDown
    expr: min(firehose_value_metric_p_rabbitmq_p_rabbitmq_service_broker_heartbeat) by(environment, bosh_deployment, bosh_job_name, bosh_job_ip) != 1
    for: <%= p('p_rabbitmq_alerts.service_broker_down.evaluation_time') %>
    labels:
      service: p-rabbitmq
      severity: critical
    annotations:
      description: The RabbitMQ Service Broker instance at `{{$labels.environment}}/{{$labels.bosh_deployment}}/{{$labels.bosh_job_name}}/{{$labels.bosh_job_ip}}` has been down for the last <%= p('p_rabbitmq_alerts.service_broker_down.evaluation_time') %>
      summary: Rabbitmq for PCF Service Broker instance `{{$labels.environment}}/{{$labels.bosh_deployment}}/{{$labels.bosh_job_name}}/{{$labels.bosh_job_ip}}` is down
